<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Lobster&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
    <title>Patient Bill</title>
</head>

<body>
    <header>
        <h1>Dr. Alvin G. Vales, MD</h1>

<script src="./charges_display.js" type="text/javascript"></script>

<script>
  // Source: From frame source of invoice on Assigment 1 examples
  let params = (new URL(document.location)).searchParams; // allows access to GET
  var quantities = []; // creates array for quantities
  // if form submitted form is processed
  if (params.has('purchase_submit')) {
    // takes quantity wanted to be purchased if it is greater than 0 and assigns it to quantities
    for (i = 0; i < charges.length; i++) {
      if (params.has(`quantity${i}`)) {
        // asigns it to a function
        a_qty = params.get(`quantity${i}`);
        // asigns a_qty to quantities to be used in array
         quantities[i] = a_qty;
      }
    }
  } else {
    document.write('Sorry, no form has been submitted. Please try again.'); // error message if no quantities are entered
  }
  console.log(quantities); // writes quantities
</script>

</header>

<body>
  <div class=container5>
    <br>
    <h1><b>Patient Bill Summary for <script>document.write(new Date().toLocaleDateString());</script></b></h1>
    <br>
    Confirm information before billing patient's account.
    <br>
  </header>
  </div>
  <script>
  </script>
  <br>
  <br>
  <table border="2" align="center">
    <tbody>
      <tr>
        <th style="text-align: center;" width="43%">Service</th>
        <th style="text-align: center;" width="11%">Quantity</th>
        <th style="text-align: center;" width="13%">Unit Price</th>
        <th style="text-align: center;" width="54%">Amount</th>
      </tr>
      <script>
        total = 0;
        for (i = 0; i < charges.length; i++) {
          if (quantities[i] > 0) {
            // product row
            extended_price = quantities[i] * charges[i].price
            total += extended_price;
            document.write(`
      <tr>
        <td align="center" td width="43%">${charges[i].service}</td>
        <td align="center" width="11%">${quantities[i]}</td>
        <td align="center" width="13%">\$${charges[i].price}</td>
        <td align="center" width="54%" >\$${extended_price}</td>
      </tr>
      `);
          }
        }
        // Compute grand total
        var total = total
      </script>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">TOTAL CHARGES</td>
        <td width="54%" style="text-align: center;">$
          <script>document.write(total);</script>
        </td>
      </tr>
      <tr>
      </tr>
    </tbody>

  </table>
<br>
<br>
<footer>
    Post Charges
    <form name="post_charges_form" action="/post_invoice" method="POST">
    <a id="charges_form"><input type="submit" value="Confirm" name="charges_submit"></a>
    <style>
        input[type=submit] {
            background-color: whitesmoke;
            border: solid black 0.2px;
            color: black;
            padding: 16px 32px;
            text-decoration: none;
            margin: 20px 2px;
            cursor: pointer;
        }
    </style>
    </form>
  </footer>
</body>

