<script src="./products.js" type="text/javascript"></script>
<script>
  // Source: From frame source of invoice on Assigment 1 examples
  let params = (new URL(document.location)).searchParams; // allows access to GET
  var quantities = []; // creates array for quantities

  // if form submitted form is processed
  if (params.has('purchase_submit')) {

    // takes quantity wanted to be purchased if it is greater than 0 and assigns it to quantities
    for (i = 0; i < products.length; i++) {
      if (params.has(`quantity${i}`)) {
        // asigns it to a function
        a_qty = params.get(`quantity${i}`);

        // asigns a_qty to quantities to be used in array
         quantities[i] = a_qty;
      }
    }
  } else {
    document.write('Sorry, no form has been submitted. Please try again.'); // error message if no quantities are entered
  }
  console.log(quantities); // writes quantities
</script>

</script>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="invoice-style.css">
  <link href="https://fonts.googleapis.com/css?family=Dancing+Script&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Petit+Formal+Script&display=swap" rel="stylesheet">
  <title>Clipz by Alyssa</title>
</head>

<header>
<body>
  <div class=container5>
    <br>
    <h1><b>Your Purchase Order</b></h1>
    Thank you for choosing Clipz by Alyssa!
    <br>Confirm information on purchase order.
    <br>
    <br>
  </header>
  </div>
  <br>
  <br>
  <table border="2" align="center">
    <tbody>
      <tr>
        <th style="text-align: center;" width="43%">Item</th>
        <th style="text-align: center;" width="11%">Quantity</th>
        <th style="text-align: center;" width="13%">Unit Price</th>
        <th style="text-align: center;" width="54%">Amount</th>
      </tr>
      <script>
        subtotal = 0;
        for (i = 0; i < products.length; i++) {
          if (quantities[i] > 0) {
            // product row
            extended_price = quantities[i] * products[i].price
            subtotal += extended_price;
            document.write(`
      <tr>
        <td align="center" td width="43%">${products[i].item}</td>
        <td align="center" width="11%">${quantities[i]}</td>
        <td align="center" width="13%">\$${products[i].price}</td>
        <td align="center" width="54%" >\$${extended_price}</td>
      </tr>
      `);
          }
        }
        // Compute tax
        var tax_rate = 0.04;
        var tax = tax_rate * subtotal;
        // Compute shipping
        if (subtotal <= 50) {
          shipping = 3;
        }
        else if (subtotal <= 100) {
          shipping = 5;
        }
        else if (subtotal > 100) {
          shipping = 0;
        }
        // Compute grand total
        var total = subtotal + tax + shipping;
      </script>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
        <td width="54%" style="text-align: center;">$
          <script>document.write(subtotal);</script>
        </td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%"> Tax @
          <script>document.write(100 * tax_rate);</script>%</span></td>
        <td width="54%" style="text-align: center;">$
          <script>document.write(tax.toFixed(2));</script>
        </td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">Shipping</span></td>
        <td width="54%" style="text-align: center;">$
          <script>document.write(shipping.toFixed(2));</script>
        </td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%"><strong>TOTAL</strong></td>
        <td width="54%" style="text-align: center;"><strong>$
            <script>document.write(total.toFixed(2));</script></strong></td>
      </tr>
    </tbody>

  </table>
<br>
<br>
<footer>
    <br><b>
      <h3>Clipz By Alyssa Shipping Policy:
    </b></h3>
    <br> Subtotals $0 - $49.99 will be $3 shipping
    <br> Subtotals $50.00 - $99.99 will be $5 shipping
    <br> Subtotals over $100 will have free shipping
    <br> 
    <h3>Clipz By Alyssa Return & Exchange Policy:
    </b></h3>
    <br> If you purchased a product and change your mind at the time you receive it, 
    <br> you may exchange it for store credit within 30 days. 
    <br> Store credit is only given for products that are still in unopened and unused condition. 
    <br> Products must not be opened, worn or tampered with due to hygienic reasons and the safety of our customers.  
    <br>
    <br>
  </footer>
</body>